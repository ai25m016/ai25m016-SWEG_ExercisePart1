#!/bin/sh

MSG_FILE="$1"
MSG="$(head -n 1 "$MSG_FILE")"
BRANCH="$(git rev-parse --abbrev-ref HEAD)"

case "$BRANCH" in
  feature/*|bugfix/*|hotfix/*|release/*)
    if echo "$BRANCH" | grep -Eq '^(feature|bugfix|hotfix|release)/[0-9]+-'; then
      ISSUE_NUM="$(echo "$BRANCH" | sed -E 's@^[^/]+/([0-9]+)-.*@\1@')"
      
      if ! echo "$MSG" | grep -q "#$ISSUE_NUM"; then
        echo "❌ Commit abgebrochen."
        echo "    Branch: $BRANCH  → erwartete Issue-Nummer: #$ISSUE_NUM"
        echo "    Bitte die Issue-Nummer in die erste Zeile der Commit-Message schreiben."
        echo "    Beispiel: \"Ordnerstruktur angepasst (#$ISSUE_NUM)\""
        exit 1
      fi
    else
      echo "❌ Commit abgebrochen."
      echo "    Branch-Name entspricht nicht dem Schema:"
      echo "    Erwarte z.B.: feature/2-beschreibung oder hotfix/5-irgendwas"
      exit 1
    fi
    ;;
  *)
    # Auf anderen Branches (main, develop, etc.) nichts prüfen
    ;;
esac

exit 0
